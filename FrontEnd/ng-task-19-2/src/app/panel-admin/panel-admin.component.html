<!-- Spinner de carga -->
<div *ngIf="cargandoLista">
  <div class="text-center py-16 flex flex-col items-center gap-3">
    <div class="w-10 h-10 relative">
      <div class="absolute inset-0 border border-slate-200 rounded-full"></div>
      <div class="absolute inset-0 border-t-2 border-l-2 border-emerald-500 rounded-full animate-spin"></div>
    </div>
    <p class="mt-3 text-slate-500 font-light tracking-wide">Cargando usuarios...</p>
  </div>
</div>

<!-- Error al cargar -->
<div *ngIf="!cargandoLista && errorAlCargar" class="text-center py-10 text-red-500">
  No se pudieron cargar los usuarios. Intenta nuevamente más tarde.
</div>

<!-- Panel principal -->
<div *ngIf="!cargandoLista && !errorAlCargar">
  <h2 class="text-xl font-semibold mb-4">Lista de usuarios</h2>

  <!-- Buscador -->
  <div class="mb-4">
    <input
      type="text"
      placeholder="Buscar por email, nombre o apellidos..."
      [(ngModel)]="filtro"
      class="border px-3 py-2 w-full rounded shadow-sm focus:outline-none focus:ring focus:border-emerald-400"
    />
  </div>

  <!-- Tabla de usuarios -->
  <div class="overflow-x-auto">
    <table class="min-w-full text-left border border-gray-200 rounded overflow-hidden">
      <thead class="bg-gray-100">
        <tr>
          <th class="py-2 px-4">Email</th>
          <th class="py-2 px-4">Nombre</th>
          <th class="py-2 px-4">Apellidos</th>
          <th class="py-2 px-4">Teléfono</th>
          <th class="py-2 px-4">Rol</th>
          <th class="py-2 px-4">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuariosFiltrados" class="border-t hover:bg-gray-50">
          <td class="py-2 px-4">{{ usuario.email }}</td>
          <td class="py-2 px-4">{{ usuario.nombre || '—' }}</td>
          <td class="py-2 px-4">{{ usuario.apellidos || '—' }}</td>
          <td class="py-2 px-4">{{ usuario.telefono || '—' }}</td>
          <td class="py-2 px-4">
            <select [(ngModel)]="usuario.rol.id" class="border rounded px-2 py-1 w-full">
              <option *ngFor="let rol of rolesDisponibles" [value]="rol.id">
                {{ rol.nombre }}
              </option>
            </select>
          </td>
          <td class="py-2 px-4">
            <button
              (click)="actualizarRol(usuario)"
              [disabled]="actualizandoRolEmail === usuario.email"
              class="bg-emerald-500 hover:bg-emerald-600 text-white text-sm px-3 py-1 rounded flex items-center justify-center gap-2"
            >
              <span *ngIf="actualizandoRolEmail === usuario.email" class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></span>
              <span *ngIf="actualizandoRolEmail !== usuario.email">Guardar</span>
              <span *ngIf="actualizandoRolEmail === usuario.email">Guardando...</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="usuariosFiltrados.length === 0" class="text-center text-gray-500 mt-6">
    No se encontraron usuarios con ese criterio.
  </div>
</div>
